<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MENVOUS STORE - FishIt Store</title>
    <style>
        body {
            margin: 0;
            font-family: Poppins, sans-serif;
            background: #f5f9ff;
            color: #0a1f44
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, #00c851, #00e676);
            /* Warna hijau untuk nav */
            padding: 1rem 1.5rem;
            color: #fff;
            position: sticky;
            top: 0;
            z-index: 1000
        }

        .logo {
            font-weight: 700;
            font-size: 1.2rem
        }

        .menu {
            cursor: pointer;
            font-size: 1.5rem
        }

        .menuContent {
            display: none;
            background: #e9fcef;
            /* Warna hijau untuk menu */
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: flex-start
        }

        .menuContent button {
            flex: 1;
            padding: .5rem;
            border-radius: 8px;
            border: none;
            background: #00c851;
            /* Warna hijau yang lebih terang untuk tombol */
            color: #fff;
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center
        }

        .menuContent button:hover {
            background: #00e676
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            padding: 1rem
        }

        .product {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 128, 64, .12)
        }

        .product img {
            width: 100%;
            height: 130px;
            object-fit: cover;
            background: #c8f9d2
        }

        .product h3 {
            margin: .6rem 0;
            color: #007f3d;
            font-size: 1rem
        }

        .product p {
            color: #5a6f8f;
            margin: 0 0 .8rem
        }

        .product button {
            background: #00c851;
            border: none;
            color: #fff;
            padding: .5rem 1rem;
            border-radius: 8px;
            cursor: pointer
        }

        .product button:hover {
            background: #00e676
        }

        .form-section {
            background: #e9fcef;
            margin: 1rem;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 128, 64, .08)
        }

        .cart {
            background: #fff;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            box-shadow: 0 3px 8px rgba(0, 128, 64, .08)
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: .35rem 0;
            border-bottom: 1px solid #eee
        }

        .cart-total {
            text-align: right;
            font-weight: 700;
            color: #009e52;
            margin-top: .5rem
        }

        .btn {
            padding: .6rem 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer
        }

        .btn-primary {
            background: #00c851;
            color: #fff
        }

        .btn-primary:hover {
            background: #00e676
        }

        .btn-success {
            background: #28a745;
            color: #fff;
            margin-right: 5px
        }

        .btn-danger {
            background: #dc3545;
            color: #fff;
            margin-right: 5px
        }

        .modal {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, .45);
            z-index: 9999
        }

        .modal-card {
            background: #fff;
            padding: 1rem;
            border-radius: 10px;
            max-width: 420px;
            width: 95%
        }

        .payment-methods {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap
        }

        .payment-methods button {
            flex: 1;
            padding: .6rem;
            border-radius: 8px;
            border: 2px solid #00c851;
            background: #fff;
            color: #007f3d;
            cursor: pointer
        }

        .payment-methods button.active {
            background: #00c851;
            color: #fff
        }

        .transaksi-card {
            background: #fff;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 3px 8px rgba(0, 128, 64, .1)
        }

        .admin-card {
            background: #fff;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 3px 8px rgba(0, 128, 64, .1)
        }

        /* Style untuk form ulasan */
        .ulasan-form {
            margin-top: 1rem;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9
        }

        /* Style untuk daftar ulasan */
        .daftar-ulasan {
            margin-top: 1rem;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9
        }
    </style>
</head>

<body>
    <nav>
        <div class="logo">MENVOUS STORE</div>
        <div class="menu" onclick="toggleMenu()">‚â°</div>
    </nav>
    <div id="menuContent" class="menuContent">
        <button onclick="scrollToSection('home')">Home</button>
        <button onclick="scrollToSection('products')">Produk</button>
        <button onclick="scrollToSection('transaksiList')">Check Invoice</button>
        <button onclick="scrollToSection('ulasanSection')">Ulasan</button>
    </div>
    <div id="products" class="product-grid">
        <div class="product" data-stok="1">
      <h3>AKUN ELEMENT</h3>
      <p>Rp 200.000</p>
      <button onclick="tambahKeranjang('AKUN ELEMENT',200000)">Tambah</button>
    </div>

    <div class="product" data-stok="1">
      <h3>AKUN GHOSTFINN</h3>
      <p>Rp 55.000</p>
      <button onclick="tambahKeranjang('AKUN GHOSTFINN',55000)">Tambah</button>
    </div>
    
    <div class="product" data-stok="1">
      <h3>AKUN GHOSTFINN</h3>
      <p>Rp 50.000</p>
      <button onclick="tambahKeranjang('AKUN GHOSTFINN',50000)">Tambah</button>
    </div>

    <div class="product" data-stok="1">
      <h3>AKUN BAMBO</h3>
      <p>Rp 45.000</p>
      <button onclick="tambahKeranjang('AKUN BAMBOO',45000)">Tambah</button>
    </div>

    <div class="product" data-stok="1">
      <h3>AKUN ANGLER</h3>
      <p>Rp 40.000</p>
      <button onclick="tambahKeranjang('AKUN ANGLER',40000)">Tambah</button>
    </div>

    <div class="product" data-stok="1">
      <h3>AKUN ARES</h3>
      <p>Rp 35.000</p>
      <button onclick="tambahKeranjang('AKUN ARES',35000)">Tambah</button>
    </div>

    <div class="product" data-stok="1">
      <h3>AKUN ASTRAL</h3>
      <p>Rp 30.000</p>
      <button onclick="tambahKeranjang('AKUN ASTRAL',30000)">Tambah</button>
    </div>

    <div class="product" data-stok="1">
      <h3>AKUN HAZMAT</h3>
      <p>Rp 30.000</p>
      <button onclick="tambahKeranjang('AKUN HAZMAT',30000)">Tambah</button>
    </div>

    <div class="product" data-stok="1">
      <h3>COIN FISH IT</h3>
      <p>Rp 20.000</p>
      <button onclick="tambahKeranjang('COIN FISH IT',20000)">Tambah</button>
    </div>

    <div class="product" data-stok="1">
      <h3>SECRET TUMBAL</h3>
      <p>Rp 7.000</p>
      <button onclick="tambahKeranjang('SECRET TUMBAL',7000)">Tambah</button>
    </div>
      
    </div>
    <div class="form-section">
        <h2>üíæ Data Pembeli</h2>
        <input type="email" id="email" placeholder="Email"
            style="width:100%;padding:.6rem;border-radius:8px;border:1.5px solid #a8f0b5;margin-bottom:.5rem">
        <input type="tel" id="whatsapp" placeholder="08xxxxxxxxxx"
            style="width:100%;padding:.6rem;border-radius:8px;border:1.5px solid #a8f0b5;margin-bottom:.5rem">
        <div class="payment-methods">
            <button id="btnQRIS" onclick="pilihMetode('QRIS')">QRIS</button>
            <button id="btnDana" onclick="pilihMetode('Dana')">Dana</button>
            <button id="btnGoPay" onclick="pilihMetode('GoPay')">GoPay</button>
        </div>
        <div class="cart" id="cart">
            <h3>üõí Keranjang Belanja</h3>
            <div id="cartItems"></div>
            <div class="cart-total" id="cartTotal">Total: Rp 0</div>
        </div>
        <button class="btn btn-primary" onclick="bayarSekarang()">Bayar Sekarang</button>
    </div>
    <h2 id="transaksiList" style="margin-left:1rem">üìÑ Check Invoice</h2>
    <div id="transaksiList" style="margin:1rem"></div>
    <!-- Fitur Ulasan Dipindahkan Ke Sini -->
    <div id="ulasanSection" style="margin:1rem">
        <h2>‚≠ê Ulasan Produk</h2>
        <div class="ulasan-form">
            <h3>Berikan Ulasan</h3>
            <form id="formUlasanUmum">
                <input type="text" id="namaPenggunaUmum" placeholder="Nama (opsional)">
                <select id="ratingUmum">
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê</option>
                    <option value="2">‚≠ê‚≠ê</option>
                    <option value="1">‚≠ê</option>
                </select>
                <select id="produkUlasan">
                    <option value="AKUN ELEMENT">AKUN ELEMENT</option>
                    <option value="AKUN GHOSTFINN">AKUN GHOSTFINN</option>
                </select>
                <textarea id="komentarUmum" placeholder="Tulis ulasan Anda di sini"></textarea>
                <button type="button" onclick="kirimUlasan()">Kirim Ulasan</button>
            </form>
        </div>
        <div class="daftar-ulasan" id="daftarUlasan">
            <h3>Ulasan Pengguna</h3>
            <!-- Ulasan akan ditampilkan di sini -->
        </div>
    </div>
    <h2 style="margin-left:1rem">üõ† Admin Panel</h2>
    <div id="adminTransaksi" style="margin:1rem"></div>
    <div id="modal" class="modal" style="display:none">
        <div class="modal-card">
            <div id="modalContent"></div>
            <div style="text-align:right;margin-top:.6rem">
                <button class="btn btn-secondary" onclick="tutupModal()">Tutup</button>
            </div>
        </div>
    </div>
    <script>
        let keranjang = [],
            totalHarga = 0,
            metodeBayar = null;
        let transaksi = JSON.parse(localStorage.getItem('transaksi')) || [];

        function pilihMetode(met) {
            metodeBayar = met;
            document.querySelectorAll('.payment-methods button').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + met).classList.add('active');
        }

        function tambahKeranjang(n, h) {
            keranjang.push({
                nama: n,
                harga: h
            });
            updateKeranjang();
        }

        function updateKeranjang() {
            const list = document.getElementById('cartItems');
            const total = document.getElementById('cartTotal');
            list.innerHTML = "";
            totalHarga = 0;
            keranjang.forEach((item, index) => {
                totalHarga += item.harga;
                const div = document.createElement('div');
                div.classList.add('cart-item');
                div.innerHTML =
                    `<span>${item.nama}</span><span>Rp ${item.harga.toLocaleString('id-ID')}</span>
    <button class="cancel-btn" onclick="hapusItem(${index})">HAPUS</button>`;
                list.appendChild(div);
            });
            total.textContent = `Total: Rp ${totalHarga.toLocaleString('id-ID')}`
        }

        function hapusItem(index) {
            keranjang.splice(index, 1);
            updateKeranjang();
        }

        function bayarSekarang() {
            const wa = document.getElementById('whatsapp').value.trim();
            const email = document.getElementById('email').value.trim();
            if (!metodeBayar) return alert("Pilih metode pembayaran!");
            if (!/^08[0-9]{8,13}$/.test(wa)) return alert("Nomor WhatsApp tidak valid!");
            if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return alert("Keranjang kosong!");
            const kode = 'INV-' + Math.floor(100000 + Math.random() * 900000);
            const items = keranjang.map(i => i.nama).join(', ');
            const total = totalHarga;
            const waktu = new Date();
            const status = 'Pending'; // langsung Pending
            const transaksiObj = {
                id: kode,
                wa,
                email,
                items,
                total,
                status,
                metode: metodeBayar,
                tanggal: waktu.toLocaleString('id-ID'),
                timestamp: waktu.getTime()
            };
            transaksi.unshift(transaksiObj);
            if (transaksi.length > 10) transaksi = transaksi.slice(0, 10);
            try {
                localStorage.setItem('transaksi', JSON.stringify(transaksi));
            } catch (e) {
                console.error("Gagal menyimpan transaksi ke localStorage:", e);
                alert("Gagal menyimpan transaksi. Silakan coba lagi.");
                return;
            }
            const imgQR = metodeBayar === 'QRIS' ? 'qr.png' : (metodeBayar === 'Dana' ? 'dana.png' :
                'gopay.png');
            document.getElementById('modalContent').innerHTML =
                `<h3>Pembayaran via ${metodeBayar}</h3>
    <p>Total: <b>Rp ${totalHarga.toLocaleString('id-ID')}</b></p>
    <img src="${imgQR}" style="max-width:250px;border-radius:8px">
    <p>Status: <b>${status}</b></p>
    <div style="margin-top:10px;">
      <button class="btn btn-primary" onclick="prosesPembayaran('${kode}')">Bayar Sekarang</button>
    </div>`; // Menghilangkan alert
            document.getElementById('modal').style.display = 'flex';
            keranjang = [];
            updateKeranjang();
            renderTransaksi();
            renderAdminTransaksi();
        }

        function prosesPembayaran(kode) {
            // Tambahkan logika pembayaran di sini
            // Misalnya, mengirim data ke server, menampilkan pesan sukses, dll.
            alert(`Simulasi pembayaran berhasil untuk kode transaksi: ${kode}!`); // Ganti dengan logika sebenarnya
            tutupModal(); // Tutup modal setelah pembayaran
        }

        function renderTransaksi() {
            let listHTML = '';
            const now = Date.now();
            transaksi.forEach((t, index) => {
                let displayStatus = t.status;
                if (t.status === 'Pending') {
                    if (now - t.timestamp > 10 * 60 * 1000) { // lebih dari 10 menit
                        t.status = 'Gagal';
                        try {
                            localStorage.setItem('transaksi', JSON.stringify(transaksi));
                        } catch (e) {
                            console.error("Gagal menyimpan transaksi ke localStorage:", e);
                        }
                    } else {
                        displayStatus = 'Pending';
                    }
                }
                const color = t.status === 'Selesai' ? 'green' : t.status === 'Gagal' ? 'red' : 'orange';
                listHTML +=
                    `<div class="transaksi-card"><b>${t.id}</b> | ${t.items} | Rp ${t.total.toLocaleString('id-ID')} |
       <span style="color:${color}">${displayStatus}</span> | ${t.tanggal} | ${maskEmail(t.email)}</div>`;
            });
            document.getElementById('transaksiList').innerHTML = listHTML;
        }

        function renderAdminTransaksi() {
            let html = '';
            transaksi.forEach((t, index) => {
                const color = t.status === 'Selesai' ? 'green' : t.status === 'Gagal' ? 'red' : 'orange';
                html +=
                    `<div class="admin-card"><b>${t.id}</b> | ${t.items} | Rp ${t.total.toLocaleString('id-ID')} |
       <span style="color:${color}">${t.status}</span> | ${t.tanggal} | ${maskEmail(t.email)}
      <div style="margin-top:5px;">
        <button class="btn btn-success" onclick="ubahStatus(${index},'Selesai')">Selesai</button>
        <button class="btn btn-danger" onclick="ubahStatus(${index},'Gagal')">Gagal</button>
      </div>
    </div>`;
            });
            document.getElementById('adminTransaksi').innerHTML = html;
        }

        function ubahStatus(index, status) {
            try {
                transaksi[index].status = status;
                localStorage.setItem('transaksi', JSON.stringify(transaksi));
                renderAdminTransaksi();
                renderTransaksi();

                const t = transaksi[index];
                // Encode the message for use in a URI
                const message = encodeURIComponent(
                    `Halo!\nStatus transaksi Anda dengan ID ${t.id} adalah: ${status}\nTotal: Rp ${t.total.toLocaleString('id-ID')}`
                );
                // Construct the WhatsApp URL
                const waLink = `https://wa.me/${t.wa}?text=${message}`;

                // Try opening the link, but catch any errors
                try {
                    window.open(waLink, '_blank');
                } catch (e) {
                    console.error("Gagal membuka tautan WhatsApp:", e);
                    alert("Gagal membuka tautan WhatsApp. Pastikan nomor WhatsApp valid.");
                }

            } catch (e) {
                console.error("Terjadi kesalahan saat mengubah status:", e);
                alert("Terjadi kesalahan saat mengubah status. Silakan coba lagi.");
            }
        }

        function maskEmail(email) {
            if (!email) return ""; // Handle null or undefined email
            const [user, domain] = email.split('@');
            if (user.length <= 2) return '**@' + domain;
            return user[0] + '**' + user[user.length - 1] + '@' + domain;
        }

        function toggleMenu() {
            const m = document.getElementById('menuContent');
            m.style.display = m.style.display === 'none' ? 'flex' : 'none';
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({
                behavior: 'smooth'
            });
        }

        function tutupModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Fungsi untuk mengirim ulasan
        function kirimUlasan() {
            const namaPengguna = document.getElementById('namaPenggunaUmum').value || 'Anonim'; // Jika nama kosong
            const rating = document.getElementById('ratingUmum').value;
            const komentar = document.getElementById('komentarUmum').value;
            const produkUlasan = document.getElementById('produkUlasan').value;
            const tanggalUlasan = new Date().toLocaleString('id-ID');

            const ulasanBaru = {
                id_produk: produkUlasan,
                nama_pengguna: namaPengguna,
                rating: parseInt(rating), // Pastikan rating adalah integer
                komentar: komentar,
                tanggal_ulasan: tanggalUlasan
            };

            // Dapatkan ulasan yang sudah ada dari localStorage
            let ulasan = JSON.parse(localStorage.getItem('ulasan')) || [];

            // Tambahkan ulasan baru ke array
            ulasan.push(ulasanBaru);

            // Simpan kembali ke localStorage
            try {
                localStorage.setItem('ulasan', JSON.stringify(ulasan));
            } catch (e) {
                console.error("Gagal menyimpan ulasan ke localStorage:", e);
                alert("Gagal menyimpan ulasan. LocalStorage mungkin penuh.");
                return;
            }

            // Tampilkan ulasan baru dan ulasan yang sudah ada
            tampilkanUlasan();

            // Reset form
            document.getElementById('formUlasanUmum').reset();
        }

        // Fungsi untuk menampilkan ulasan
        function tampilkanUlasan() {
            const daftarUlasan = document.getElementById('daftarUlasan');
            daftarUlasan.innerHTML = ''; // Kosongkan daftar ulasan

            // Dapatkan ulasan dari localStorage
            let ulasan = JSON.parse(localStorage.getItem('ulasan')) || [];

            // Tampilkan setiap ulasan
            ulasan.forEach(ulasan => {
                const divUlasan = document.createElement('div');
                divUlasan.classList.add('ulasan'); // Tambahkan class ulasan
                divUlasan.innerHTML = `
                <p><span class="ulasan-nama">${ulasan.nama_pengguna}</span> - <span class="ulasan-tanggal">${ulasan.tanggal_ulasan}</span></p>
                <p>Produk: ${ulasan.id_produk}</p>
                <p>Rating: ${tampilkanBintang(ulasan.rating)}</p>
                <p>${ulasan.komentar}</p>
              `;
                daftarUlasan.appendChild(divUlasan);
            });
        }

        // Fungsi untuk menampilkan bintang berdasarkan rating
        function tampilkanBintang(rating) {
            let bintang = '';
            for (let i = 0; i < rating; i++) {
                bintang += '‚≠ê';
            }
            return bintang;
        }

        // Inisialisasi ulasan saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function () {
            tampilkanUlasan();
        });
        updateKeranjang();
        renderTransaksi();
        renderAdminTransaksi();
        setInterval(renderTransaksi, 60000); // cek setiap menit untuk auto gagal
    </script>
</body>

</html>
